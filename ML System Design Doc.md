# ML System Design Doc 
## Дизайн ML системы - \<Проектирование и реализация программного комплекса автоматизированного контроля подвижного состава на железнодорожных путях\> \<MVP or Production System\> \<Номер\>

### 1. Цели и предпосылки 
#### 1.1. Зачем идем в разработку продукта?  
   
- Бизнес-цель (Product Owner):
Автоматизация определения стороны вагона по изображениям для оптимизации логистических процессов, снижения ошибок и ускорения обработки данных.
Уменьшение зависимости от ручного труда и повышение точности идентификации вагонов.

- Почему станет лучше? (Product Owner & Data Scientist):
Сокращение времени на обработку изображений вагонов.
Повышение точности определения стороны вагона (например, для корректной загрузки/разгрузки).
Интеграция с существующими системами мониторинга и управления вагонным парком.

- Критерии успеха итерации (Product Owner):
Точность определения стороны вагона ≥ 95% на тестовой выборке.
Время обработки одного изображения ≤ 350 милисекунд.
Успешная интеграция модели в текущий бизнес-процесс (пилот на 1–2 полигонах).

#### 1.2. Бизнес-требования и ограничения  

- Бизнес-требования:
Определение стороны вагона (левая/правая) по фотографии с камеры.
Работа в реальном времени или близком к нему (задержка ≤ 350 милисек).
Интеграция с системой мониторинга "ТрансТелематика".

- Бизнес-ограничения:
Ограниченный доступ к данным: изображения вагонов только с определенных ракурсов.
Необходимость работы в условиях переменного освещения и погодных условий.

- Описание бизнес-процесса пилота:
Камеры фиксируют изображения вагонов на входе/выходе с полигона.
Модель определяет сторону вагона и передает данные в систему мониторинга.
Оператор получает уведомление о результате (например, для корректировки маршрута).

- Критерии успешного пилота:
Точность ≥ 95% на реальных данных.
Стабильная работа модели в условиях полигона.
Положительный фидбек от операторов.

#### 1.3. Что входит в скоуп проекта/итерации, что не входит  

- Что входит в скоуп:
Разработка модели компьютерного зрения для определения стороны вагона.
Подготовка датасета изображений вагонов (с разметкой).
Интеграция модели в тестовую среду "ТрансТелематика".

- Что не входит:
Разработка новых камер или аппаратного обеспечения.
Полная автоматизация бизнес-процессов (только пилот).

- Технический долг:
Оптимизация модели для работы на edge-устройствах (отложено на следующую итерацию).
Расширение датасета для редких типов вагонов.

#### 1.4. Предпосылки решения  

- Данные: Изображения вагонов с камер полигона (разрешение 1280×720).
- Элементы: Определение элементов вагонов (кран, бак, тормозной шток) для распознавание стороны вагона.
- Бинарная классификация: Определение стороны вагона (левая/правая).
- Горизонт прогноза: Реальное время (обработка каждого изображения по мере поступления).


### 2. Методология `Data Scientist` 
#### 2.1. Постановка задачи  

- Техническая задача: Бинарная классификация изображений (левая/правая сторона вагона).
- Метод: Использование сверточных нейронных сетей (CNN) или трансформеров (ViT) для анализа изображений.

#### 2.2. Блок-схема решения  

- Этап 1: Подготовка данных
- Этап 2: Обучение модели
- Этап 3: Тестирование и валидация
- Этап 4: Интеграция
- Этап 5: Подготовка финального отчёта и завершение пилота

#### 2.3. Этапы решения задачи

##### Этап 1: Подготовка данных

| Название данных  | Есть ли данные в компании (если да, название источника/витрин) | Требуемый ресурс для получения данных (какие роли нужны) | Проверено ли качество данных (да, нет) |
| ------------- | ------------- | ------------- | ------------- |
| Изображения вагонов | Камеры полигона  | DE/DS | + |

- Результат этапа:
Датасет из 5000+ размеченных изображений (левая/правая сторона).

##### Этап 2: Обучение модели

###### MVP:
- Формирование выборки: Данные делятся на обучающую (70%), валидационную (15%) и тестовую (15%) выборки. Выборка репрезентативна: включает изображения с разных ракурсов, при различном освещении и для разных типов вагонов.
- Горизонт и гранулярность: Модель обучается для бинарной классификации (левая/правая сторона) с обработкой каждого изображения в реальном времени.
- Целевая переменная: Бинарный класс — "левая сторона" или "правая сторона".
- Метрики качества: Accuracy ≥ 95%, Precision/Recall ≥ 94%. Эти метрики напрямую влияют на бизнес-результат, так как снижают количество ошибок при определении стороны вагона.
- Риски: Недостаток данных для редких типов вагонов → дополнение датасета. Возможное падение точности при изменении условий съемки → аугментация данных.
- Техника: Используется архитектура ResNet50 с fine-tuning. Кросс-валидация по 5 фолдам для оценки устойчивости модели.
- Бизнес-проверка: Результаты валидируются с участием Product Owner на тестовом полигоне.

###### Бейзлайн:
- Формирование выборки: Используется та же выборка, но с упрощенной разметкой.
- Метрики качества: Accuracy ≥ 85% (достаточно для проверки гипотезы).
- Техника: MobileNet для быстрого прототипирования. Обучение без аугментации.
- Риски: Низкая точность на сложных случаях → переход к MVP.

##### Этап 3: Тестирование и валидация

###### MVP:
- Формирование выборки: Тестирование проводится на отдельной выборке, включающей реальные данные с полигона.
- Метрики качества: Accuracy ≥ 95%, F1-score ≥ 94%. Проверка устойчивости модели к изменению условий (освещение, ракурс).
- Риски: Падение точности при работе в реальных условиях → дообучение модели на новых данных.
- Бизнес-проверка: Тестирование на пилотном полигоне с участием операторов.

###### Бейзлайн:
- Метрики качества: Accuracy ≥ 80% (базовый уровень для сравнения).
- Риски: Ограниченная обобщающая способность → переход к MVP.

##### Этап 4: Интеграция

###### MVP:
- Формирование выборки: Модель интегрируется в тестовую среду "ТрансТелематика" для обработки потока изображений в реальном времени.
- Метрики качества: Время обработки ≤ 1 секунды, стабильная работа без сбоев.
- Риски: Проблемы совместимости с существующей инфраструктурой → тестирование API и оптимизация кода.
- Бизнес-проверка: Пилотное тестирование на 1–2 полигонах с оценкой влияния на бизнес-процессы.

###### Бейзлайн:
- Метрики качества: Время обработки ≤ 2 секунды (приемлемо для прототипа).
- Риски: Низкая производительность → оптимизация модели для продуктивной среды.

##### Этап 5: Подготовка финального отчёта и завершение пилота

###### MVP:
- Формирование выборки: Анализируются результаты пилотного тестирования на полигонах, включая метрики точности, скорости обработки и стабильности работы модели.
- Ожидаемые результаты:
Готовая модель с точностью ≥ 95% на реальных данных.
- Отчёт о результатах пилота, включающий:
Анализ метрик (Accuracy, Precision, Recall, F1-score).
Оценку влияния модели на бизнес-процессы (сокращение времени обработки, снижение ошибок).
Выявленные проблемы и ограничения (например, сложности с редкими типами вагонов).
- Рекомендации по масштабированию:
План внедрения модели на всех полигонах компании.
Предложения по улучшению (например, расширение датасета, оптимизация модели для edge-устройств).
Оценка затрат и ресурсов для полноценного внедрения.
- Бизнес-проверка: Отчёт согласовывается с Product Owner и ключевыми заинтересованными сторонами для принятия решения о дальнейшем развитии проекта.

###### Бейзлайн:

- Ожидаемые результаты:
- Базовый отчёт с анализом метрик (Accuracy ≥ 80–85%).
- Выводы о целесообразности перехода к полноценной реализации (MVP).
- Рекомендации по улучшению датасета и архитектуры модели.



